{% extends "base.html" %}
{% block content %}

<!-- 상단: 최신 회차 정보 + 업데이트 버튼 -->
<div class="card mb-3 shadow-sm">
  <div class="card-body d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-3">
    <div>
      <h4 class="m-0">
        {% if latest_draw %}
          최신 회차: <strong>{{ latest_draw.round }}회</strong>
          <span class="text-muted ms-2">({{ latest_draw.draw_date }})</span>
        {% else %}
          최신 회차: <strong>없음</strong>
        {% endif %}
      </h4>
      {% if latest_draw %}
        <div class="mt-2">
          당첨번호:
          <strong>{{ latest_draw.n1 }}, {{ latest_draw.n2 }}, {{ latest_draw.n3 }}, {{ latest_draw.n4 }}, {{ latest_draw.n5 }}, {{ latest_draw.n6 }}</strong>
          <span class="ms-2">보너스: <strong>{{ latest_draw.bonus }}</strong></span>
        </div>
      {% endif %}
      <div class="text-muted small mt-2">총 수집 회차: {{ total_count }}</div>
    </div>
    <div class="d-flex gap-2">
      <form method="post" action="{{ url_for('dashboard.update_now') }}">
        <button class="btn btn-outline-primary">신규 회차 업데이트</button>
      </form>
    </div>
  </div>
</div>

<div class="row g-3">

  <!-- 추천 번호 + 이유 (캐시된 세트) -->
  <div class="col-12">
    <div class="card">
      <div class="card-body">
        <div class="d-flex align-items-center justify-content-between mb-3">
          <h5 class="card-title m-0">추천 번호 <span class="text-muted">(회차별 캐시)</span></h5>
          <form method="post" action="{{ url_for('dashboard.refresh_recommend') }}">
            <button class="btn btn-primary">새로 추천</button>
          </form>
        </div>

        {% if not has_recommend %}
          <div class="alert alert-info">
            아직 이 회차에 대한 추천이 생성되지 않았습니다. <strong>새로 추천</strong> 버튼을 눌러 생성하세요.
          </div>
        {% else %}
          <div class="row">
            <div class="col-md-6">
              <h6 class="text-muted">전체 조합 5개</h6>
              <ol class="mb-0">
                {% for combo, reason in full_with_reason %}
                  <li class="mb-1">
                    <strong>{{ combo|join(', ') }}</strong>
                    <div class="small text-muted">이유: {{ reason }}</div>
                  </li>
                {% endfor %}
              </ol>
            </div>
            <div class="col-md-6">
              <h6 class="text-muted">반자동(3개 추천) 5세트</h6>
              <ol class="mb-0">
                {% for triple in semi %}
                  <li class="mb-1"><strong>{{ triple|join(', ') }}</strong> + 자유선택 3개</li>
                {% endfor %}
              </ol>
            </div>
          </div>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- 최근 10회차 -->
  <div class="col-lg-6">
    <div class="card h-100">
      <div class="card-body">
        <h5 class="card-title">최근 10회차</h5>
        <table class="table table-sm">
          <thead><tr><th>회차</th><th>추첨일</th><th>번호</th><th>보너스</th></tr></thead>
          <tbody>
          {% for d in recent %}
            <tr>
              <td>{{ d.round }}</td>
              <td>{{ d.draw_date }}</td>
              <td>{{ d.n1 }}, {{ d.n2 }}, {{ d.n3 }}, {{ d.n4 }}, {{ d.n5 }}, {{ d.n6 }}</td>
              <td>{{ d.bonus }}</td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>


</div>
{% endblock %}
